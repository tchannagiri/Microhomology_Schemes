
<body>
  <div style="font-size: 20">
    <label>Guide:</label>
    <select name="Breaks" id="Breaks" onchange="update_schemes()">
      <option value="hg39">sgRNA A</option>
      <option value="hg42">sgRNA B</option>
      <option value="2dsb">sgRNA A & B</option>
    </select>
    <label>Strand:</label>
    <select name="strand" id="strand" onchange="update_schemes()">
      <option value="Forward">Forward</option>
      <option value="Reverse">Reverse</option>
    </select>
    <label>Cell Type:</label>
    <select name="Celltype" id="Celltype" onchange="update_schemes()">
      <option value="wt">Normal</option>
      <option value="db">BranchÎ”</option>
    </select>
    <label>Group:</label>
    <select name="Type" id="Type" onchange="update_schemes()">
      <option value="all">All</option>
      <option value="exon_exon">Exon & Exon</option>
      <option value="exon_intron">Exon & Intron</option>
    </select>
    <label>Display format:</label>
    <select name="combined" id="combined" onchange="update_schemes()">
      <option value="combined" selected>Combined</option>
      <option value="separate">Separate</option>
    </select>
    <button onclick="download_svg()" style="margin-right: 10px;">
      Download SVG
    </select>
    <button onclick="download_all_svg()">
      Download All SVG
    </select>
  </div>
  <div style="font-size: 30; margin-bottom: 50;" id="title">
  </div>
  <div id="schemes">
  </div>
</body>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="schemes_data.js"></script>
<script src="schemes.js"></script>

<script>
  function get_svg_file_name() {
    var Breaks = document.querySelector("#Breaks").value;
    var Strand = document.querySelector("#Strand").value;
    var Celltype = document.querySelector("#Celltype").value;
    var Type = document.querySelector("#Type").value;
    var combined = document.querySelector("#combined").value;

    Breaks = {'hg39': 'sgA', 'hg42': 'sgB', '2dsb': 'sgAB'}[Breaks];
    Celltype = {'wt': 'wt', 'db': 'branch'}[Celltype];

    return `microhomology_schemes_${Breaks}_${Strand}_${Celltype}_${combined}`;
  }

  // function download_svg(file_name, text) {
  function download_svg() {
    var text = document.querySelector('#schemes').innerHTML;
    var file_name = get_svg_file_name();

    var element = document.createElement('a');
    element.setAttribute('href', 'data:text/svg;charset=utf-8,' + encodeURIComponent(text));
    element.setAttribute('download', file_name + '.svg');

    element.style.display = 'none';
    document.body.appendChild(element);

    element.click();

    document.body.removeChild(element);
  }

  function download_all_svg() {
    for (var Breaks of ['hg39', 'hg42', '2dsb']) {
      for (var Strand of ['Forward', 'Reverse']) {
        for (var Celltype of ['wt', 'db']) {
          document.querySelector("#Breaks").value = Breaks;
          document.querySelector("#Strand").value = Strand;
          document.querySelector("#Celltype").value = Celltype;
          document.querySelector("#Type").value = 'all'
          document.querySelector("#combined").value = 'combined'
          download_svg();
        }
      }
    }
  }
</script>

<script>
  function update_schemes() {
    var Breaks = document.querySelector("#Breaks");
    var Strand = document.querySelector("#Strand");
    var Celltype = document.querySelector("#Celltype");
    var Type = document.querySelector("#Type");
    var combined = document.querySelector("#combined");
    document.querySelector("#title").innerHTML = (
      `${Breaks.options[Breaks.selectedIndex].innerHTML} ` +
      `${Strand.value} ` +
      `${Celltype.options[Celltype.selectedIndex].innerHTML} ` +
      `Microhomologies (${combined.value})`
    );
    make_schemes(
      '#schemes',
      Breaks.value,
      Strand.value,
      Celltype.value,
      Type.value,
      combined.value == "combined"
    );
  }

  window.addEventListener('load', () => update_schemes());
</script>